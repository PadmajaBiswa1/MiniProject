<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareCal Fitness</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #212529;
            --success: #4bb543;
            --warning: #ffcc00;
            --danger: #dc3545;
            --male: #4cc9f0;
            --female: #f72585;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            border-radius: 0 0 20px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .logo i {
            font-size: 2.2rem;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 20px;
        }
        
        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 20px;
            transition: background 0.3s;
        }
        
        nav a:hover, nav a.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .auth-section {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-btn {
            background: transparent;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
            text-decoration: none;
            font-weight: 500;
        }
        
        .auth-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--secondary);
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .male-icon {
            background-color: rgba(76, 201, 240, 0.2);
            color: var(--male);
        }
        
        .female-icon {
            background-color: rgba(247, 37, 133, 0.2);
            color: var(--female);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--accent);
            outline: none;
        }
        
        .gender-selection {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .gender-option {
            flex: 1;
            text-align: center;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .gender-option.selected {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .male-option.selected {
            border-color: var(--male);
            background-color: rgba(76, 201, 240, 0.1);
        }
        
        .female-option.selected {
            border-color: var(--female);
            background-color: rgba(247, 37, 133, 0.1);
        }
        
        .gender-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: var(--secondary);
        }
        
        .btn-block {
            display: block;
            width: 100%;
            text-align: center;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .stat-title {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .calories {
            color: var(--warning);
        }
        
        .protein {
            color: var(--success);
        }
        
        .weight {
            color: var(--primary);
        }
        
        .chart-container {
            margin-top: 30px;
            height: 300px;
        }
        
        .history {
            margin-top: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            font-weight: 600;
            color: var(--secondary);
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress {
            height: 100%;
            border-radius: 4px;
        }
        
        .calories-progress {
            background-color: var(--warning);
        }
        
        .protein-progress {
            background-color: var(--success);
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        /* New styles for goal section */
        .goal-section {
            background-color: rgba(67, 97, 238, 0.05);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--primary);
        }
        
        .goal-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--secondary);
        }
        
        .goal-suggestions {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .goal-suggestion {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .goal-suggestion:hover {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .goal-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .goal-input input {
            flex: 1;
        }

        /* Progress Legend Styles */
        .progress-legend {
            margin-top: 25px;
            padding: 15px;
            background-color: rgba(67, 97, 238, 0.05);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .legend-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .legend-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }
        
        .goal-display {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .goal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .goal-item:last-child {
            border-bottom: none;
        }
        
        .goal-label {
            font-weight: 500;
        }
        
        .goal-value {
            font-weight: 600;
            color: var(--primary);
        }
        
        /* Auth page styles */
        .auth-container {
            max-width: 500px;
            margin: 50px auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-title {
            font-size: 1.8rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }
        
        .auth-subtitle {
            color: #6c757d;
        }
        
        .auth-footer {
            text-align: center;
            margin-top: 20px;
            color: #6c757d;
        }
        
        .auth-footer a {
            color: var(--primary);
            text-decoration: none;
        }
        
        .auth-footer a:hover {
            text-decoration: underline;
        }
        
        .error-message {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }
        
        .hidden {
            display: none;
        }

        /* New styles for recommendation page */
        .recommendation-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .recommendation-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }

        .recommendation-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .recommendation-title {
            font-Size: 2rem;
            color: var(--secondary);
            margin-bottom: 10px;
        }

        .recommendation-subtitle {
            color: #6c757d;
            font-size: 1.1rem;
        }

        .recommendation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .recommendation-item {
            background: rgba(67, 97, 238, 0.05);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid var(--primary);
        }

        .recommendation-item-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .recommendation-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .recommendation-description {
            margin-top: 10px;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .goal-preview {
            background: rgba(76, 201, 240, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--accent);
        }

        .preview-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--secondary);
        }

        .preview-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .stats {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .goal-suggestions {
                flex-direction: column;
            }

            .recommendation-grid {
                grid-template-columns: 1fr;
            }

            .navigation-buttons {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-chart-line"></i>
                    <span>CareCal Fitness</span>
                </div>
                <div id="authSection" class="auth-section">
                    <!-- This will be populated by JavaScript based on auth status -->
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Page 1: Personal Information -->
        <div id="personalInfoPage" class="hidden">
            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Personal Information</h2>
                        <div class="card-icon male-icon">
                            <i class="fas fa-mars"></i>
                        </div>
                    </div>
                    
                    <div class="gender-selection">
                        <div class="gender-option male-option selected" onclick="selectGender('male')">
                            <div class="gender-icon">
                                <i class="fas fa-mars"></i>
                            </div>
                            <div>Male</div>
                        </div>
                        <div class="gender-option female-option" onclick="selectGender('female')">
                            <div class="gender-icon">
                                <i class="fas fa-venus"></i>
                            </div>
                            <div>Female</div>
                        </div>
                    </div>
                    
                    <form id="userForm">
                        <div class="form-group">
                            <label for="age">Age</label>
                            <input type="number" id="age" min="15" max="150" value="28" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="height">Height (cm)</label>
                            <input type="number" id="height" min="100" max="200" value="175" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="weight">Weight (kg)</label>
                            <input type="number" id="weight" min="30" max="150" step="0.1" value="75" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="activity">Activity Level</label>
                            <select id="activity" required>
                                <option value="1.2">Sedentary (little or no exercise)</option>
                                <option value="1.375">Lightly active (light exercise 1-3 days/week)</option>
                                <option value="1.55" selected>Moderately active (moderate exercise 3-5 days/week)</option>
                                <option value="1.725">Very active (hard exercise 6-7 days/week)</option>
                                <option value="1.9">Extra active (very hard exercise & physical job)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="healthCondition">Health Condition (Optional)</label>
                            <select id="healthCondition">
                                <option value="none">No specific condition</option>
                                <option value="diabetic">Diabetic</option>
                                <option value="heart_patient">Heart Patient</option>
                                <option value="both">Both Diabetic and Heart Patient</option>
                            </select>
                        </div>
                        
                        <button type="button" class="btn btn-block" onclick="calculateRecommendations()">
                            <i class="fas fa-calculator"></i> Calculate My Recommendations
                        </button>
                    </form>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">About Mifflin-St Jeor</h2>
                        <div class="card-icon" style="background-color: rgba(76, 201, 240, 0.2); color: var(--accent);">
                            <i class="fas fa-info-circle"></i>
                        </div>
                    </div>
                    
                    <div class="goal-section">
                        <p>The <strong>Mifflin-St Jeor equation</strong> is considered the most accurate method for calculating your Basal Metabolic Rate (BMR) - the number of calories your body needs at rest.</p>
                        
                        <div style="margin-top: 15px;">
                            <div class="goal-item">
                                <span class="goal-label">For Men:</span>
                                <span class="goal-value">10Ã—weight + 6.25Ã—height âˆ’ 5Ã—age + 5</span>
                            </div>
                            <div class="goal-item">
                                <span class="goal-label">For Women:</span>
                                <span class="goal-value">10Ã—weight + 6.25Ã—height âˆ’ 5Ã—age âˆ’ 161</span>
                            </div>
                        </div>
                        
                        <p style="margin-top: 15px;">Your BMR is then multiplied by your activity level to determine your Total Daily Energy Expenditure (TDEE).</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 2: Recommendations -->
        <div id="recommendationsPage" class="hidden">
            <div class="recommendation-container">
                <div class="recommendation-card">
                    <div class="recommendation-header">
                        <h1 class="recommendation-title">Your Personalized Recommendations</h1>
                        <p class="recommendation-subtitle">Based on Mifflin-St Jeor Equation</p>
                    </div>
                    
                    <div class="recommendation-grid">
                        <div class="recommendation-item">
                            <div class="recommendation-item-title">Basal Metabolic Rate (BMR)</div>
                            <div class="recommendation-value" id="bmrValue">- kcal/day</div>
                            <div class="recommendation-description">Calories your body needs at complete rest</div>
                        </div>
                        
                        <div class="recommendation-item">
                            <div class="recommendation-item-title">Total Daily Energy Expenditure (TDEE)</div>
                            <div class="recommendation-value" id="tdeeValue">- kcal/day</div>
                            <div class="recommendation-description">Calories you burn including activity</div>
                        </div>
                    </div>

                    <div class="goal-section">
                        <div class="goal-title">Recommended Goal</div>
                        <div class="goal-display">
                            <div class="goal-item">
                                <span class="goal-label">Suggested Action:</span>
                                <span class="goal-value" id="suggestedAction">-</span>
                            </div>
                            <div class="goal-item">
                                <span class="goal-label">Target Calories:</span>
                                <span class="goal-value" id="suggestedCalories">- kcal/day</span>
                            </div>
                            <div class="goal-item">
                                <span class="goal-label">Target Protein:</span>
                                <span class="goal-value" id="suggestedProtein">- g/day</span>
                            </div>
                            <div class="goal-item">
                                <span class="goal-label">Target Weight Change:</span>
                                <span class="goal-value" id="suggestedWeight">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="goal-section" id="healthRecommendations" style="display: none;">
                        <div class="goal-title">Nutrition & Fitness Recommendations</div>
                        <div class="recommendation-grid">
                            <div class="recommendation-item">
                                <div class="recommendation-item-title">Recommended Foods</div>
                                <div class="recommendation-description" id="recommendedFoods">-</div>
                            </div>
                            <div class="recommendation-item">
                                <div class="recommendation-item-title">Physical Activities</div>
                                <div class="recommendation-description" id="recommendedActivities">-</div>
                            </div>
                        </div>
                    </div>

                    <div class="navigation-buttons">
                        <button type="button" class="btn btn-secondary" onclick="showPersonalInfoPage()">
                            <i class="fas fa-arrow-left"></i> Back to Personal Info
                        </button>
                        <button type="button" class="btn" onclick="showGoalSettingPage()">
                            Continue to Goal Setting <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 3: Goal Setting -->
        <div id="goalSettingPage" class="hidden">
            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Set Your Fitness Goal</h2>
                        <div class="card-icon" style="background-color: rgba(76, 201, 240, 0.2); color: var(--accent);">
                            <i class="fas fa-bullseye"></i>
                        </div>
                    </div>
                    
                    <!-- Goal Section -->
                    <div class="goal-section">
                        <div class="goal-title">Choose Your Goal</div>
                        <div class="goal-suggestions">
                            <div class="goal-suggestion" onclick="showGoalPreview('weight_loss')">Weight Loss</div>
                            <div class="goal-suggestion" onclick="showGoalPreview('muscle_gain')">Muscle Gain</div>
                            <div class="goal-suggestion" onclick="showGoalPreview('maintenance')">Maintenance</div>
                            <div class="goal-suggestion" onclick="showGoalPreview('endurance')">Endurance</div>
                        </div>
                        
                        <!-- Goal Preview -->
<div id="goalPreview" class="goal-preview hidden">
    <div class="preview-title">Goal Preview:</div>
    <div class="preview-item">
        <span>Goal Type:</span>
        <span id="previewType">-</span>
    </div>
    <div class="preview-item">
        <span>Target Calories:</span>
        <span id="previewCalories">-</span>
    </div>
    <div class="preview-item">
        <span>Target Protein:</span>
        <span id="previewProtein">-</span>
    </div>
    <div class="preview-item">
        <span>Target Weight:</span>
        <span id="previewWeight">-</span>
    </div>
    <div class="preview-item" id="previewDescription" style="font-style: italic; color: #666; margin-top: 10px;">
        <!-- Description will be added here -->
    </div>
    <button type="button" class="btn" style="margin-top: 15px;" onclick="setGoalFromPreview()">
        <i class="fas fa-check"></i> Set This Goal
    </button>
</div>
                        
                        <div class="goal-input">
                            <input type="text" id="customGoal" placeholder="Or enter custom goal...">
                            <button type="button" class="btn" onclick="setCustomGoal()">Set Custom Goal</button>
                        </div>
                    </div>

                    <div class="navigation-buttons" style="margin-top: 30px;">
                        <button type="button" class="btn btn-secondary" onclick="showRecommendationsPage()">
                            <i class="fas fa-arrow-left"></i> Back to Recommendations
                        </button>
                        <button type="button" class="btn" onclick="showDashboardPage()">
                            Start Tracking <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Your Current Goal</h2>
                        <div class="card-icon" style="background-color: rgba(75, 181, 67, 0.2); color: var(--success);">
                            <i class="fas fa-flag"></i>
                        </div>
                    </div>
                    
                    <div class="goal-display" id="currentGoalDisplay">
                        <div class="goal-item">
                            <span class="goal-label">Current Goal:</span>
                            <span class="goal-value" id="currentGoal">Not set</span>
                        </div>
                        <div class="goal-item">
                            <span class="goal-label">Target Calories:</span>
                            <span class="goal-value" id="targetCalories">-</span>
                        </div>
                        <div class="goal-item">
                            <span class="goal-label">Target Protein:</span>
                            <span class="goal-value" id="targetProtein">-</span>
                        </div>
                        <div class="goal-item">
                            <span class="goal-label">Target Weight:</span>
                            <span class="goal-value" id="targetWeight">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Page 4: Main Dashboard -->
        <div id="dashboardPage" class="hidden">
            <div class="dashboard">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Your Goals</h2>
                        <div class="card-icon" style="background-color: rgba(76, 201, 240, 0.2); color: var(--accent);">
                            <i class="fas fa-bullseye"></i>
                        </div>
                    </div>
                    
                    <div class="goal-display">
                        <div class="goal-item">
                            <span class="goal-label">Current Goal:</span>
                            <span class="goal-value" id="dashboardGoal">Not set</span>
                        </div>
                        <div class="goal-item">
                            <span class="goal-label">Target Calories:</span>
                            <span class="goal-value" id="dashboardCalories">-</span>
                        </div>
                        <div class="goal-item">
                            <span class="goal-label">Target Protein:</span>
                            <span class="goal-value" id="dashboardProtein">-</span>
                        </div>
                        <div class="goal-item">
                            <span class="goal-label">Target Weight:</span>
                            <span class="goal-value" id="dashboardWeight">-</span>
                        </div>
                    </div>
                    
                    <button type="button" class="btn btn-block" style="margin-top: 20px;" onclick="showGoalSettingPage()">
                        <i class="fas fa-edit"></i> Modify Goals
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Daily Tracking</h2>
                        <div class="card-icon" style="background-color: rgba(76, 201, 240, 0.2); color: var(--accent);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    
                    <form id="trackingForm">
                        <div class="form-group">
                            <label for="date">Date</label>
                            <input type="date" id="date" max="" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="calories">Calories Consumed</label>
                            <input type="number" id="calories" min="0" max="2000" value="1850" required>
                        </div>

                        <div class="form-group">
                            <label for="protein">Protein Intake (g)</label>
                            <input type="number" id="protein" min="0" max="160" step="1" value="120" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="currentWeight">Current Weight (kg)</label>
                            <input type="number" id="currentWeight" min="30" max="200" step="0.1" value="74.5" required>
                        </div>
                        
                        <button type="button" class="btn btn-block" onclick="addEntry()">
                            <i class="fas fa-plus-circle"></i> Add Daily Entry
                        </button>
                    </form>
                </div>
            </div>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-title">Daily Calories</div>
                    <div class="stat-value calories">2,150</div>
                    <div class="progress-bar">
                        <div class="progress calories-progress" id="caloriesProgress" style="width: 72%"></div>
                    </div>
                    <div id="caloriesText">1,550 of 2,150 kcal</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">Protein Intake</div>
                    <div class="stat-value protein">128g</div>
                    <div class="progress-bar">
                        <div class="progress protein-progress" id="proteinProgress" style="width: 85%"></div>
                    </div>
                    <div id="proteinText">128 of 150g</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-title">Current Weight</div>
                    <div class="stat-value weight">74.5kg</div>
                    <div id="weightText">Goal: 72kg</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Progress Overview</h2>
                </div>
                <div class="chart-container">
                    <canvas id="progressChart"></canvas>
                </div>
            </div>
            
            <div class="card history">
                <div class="card-header">
                    <h2 class="card-title">Tracking History</h2>
                </div>
                
                <!-- Progress Legend - Moved here -->
                <div class="progress-legend">
                    <div class="legend-title">Goal Progress Indicators</div>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span>ðŸŸ¢</span>
                            <span>Green: Excellent (95%+ targets met)</span>
                        </div>
                        <div class="legend-item">
                            <span>ðŸŸ¡</span>
                            <span>Yellow: Good (85%+ targets met)</span>
                        </div>
                        <div class="legend-item">
                            <span>ðŸŸ </span>
                            <span>Orange: Fair (70%+ targets met)</span>
                        </div>
                        <div class="legend-item">
                            <span>ðŸ”´</span>
                            <span>Red: Needs improvement</span>
                        </div>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Calories</th>
                            <th>Protein</th>
                            <th>Weight</th>
                            <th>Goal Progress</th>
                        </tr>
                    </thead>
                    <tbody id="historyTable">
                        <!-- Data will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Auth Views (shown when not logged in) -->
        <div id="authViews" class="hidden">
            <!-- Login View -->
            <div id="loginView" class="auth-container">
                <div class="auth-header">
                    <h1 class="auth-title">Welcome Back</h1>
                    <p class="auth-subtitle">Sign in to continue tracking your fitness journey</p>
                </div>
                
                <form id="loginForm">
                <!-- Login Form - Add autocomplete attributes -->
<div class="form-group">
    <label for="loginEmail">Email Address</label>
    <input type="email" id="loginEmail" autocomplete="username" required>
    <div class="error-message" id="loginEmailError">Please enter a valid email address</div>
</div>

<div class="form-group">
    <label for="loginPassword">Password</label>
    <input type="password" id="loginPassword" autocomplete="current-password" required>
    <div class="error-message" id="loginPasswordError">Please enter your password</div>
</div>    
                    
                    <button type="submit" class="btn btn-block">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </form>
                
                <div class="auth-footer">
                    <p>Don't have an account? <a href="#" onclick="showRegister()">Create one here</a></p>
                </div>
            </div>
            
            <!-- Register View -->
            <div id="registerView" class="auth-container hidden">
                <div class="auth-header">
                    <h1 class="auth-title">Create Account</h1>
                    <p class="auth-subtitle">Join CareCal Fitness to start your fitness journey</p>
                </div>
                
                <form id="registerForm">
                    <!-- In your register form - remove any value attributes -->
<div class="form-group">
    <label for="registerName">Full Name</label>
    <input type="text" id="registerName" required>
    <!-- Remove any value="something" from this input -->
    <div class="error-message" id="registerNameError">Please enter your full name</div>
</div>

<div class="form-group">
    <label for="registerEmail">Email Address</label>
    <input type="email" id="registerEmail" required>
    <!-- Remove any value="something" from this input -->
    <div class="error-message" id="registerEmailError">Please enter a valid email address</div>
</div>

<div class="form-group">
    <label for="registerPassword">Password</label>
    <input type="password" id="registerPassword" required>
    <!-- Remove any value="something" from this input -->
    <div class="error-message" id="registerPasswordError">Password must be at least 6 characters</div>
</div>

<div class="form-group">
    <label for="confirmPassword">Confirm Password</label>
    <input type="password" id="confirmPassword" required>
    <!-- Remove any value="something" from this input -->
    <div class="error-message" id="confirmPasswordError">Passwords do not match</div>
</div>
                    
                    <button type="submit" class="btn btn-block">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                </form>
                
                <div class="auth-footer">
                    <p>Already have an account? <a href="#" onclick="showLogin()">Sign in here</a></p>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>CareCal Fitness &copy; 2025 | Track your fitness journey with precision</p>
        </div>
    </footer>

    <script>
       // Backend integration
const API_BASE_URL = 'http://localhost:5000/api';
let authToken = null;

// Authentication state management
let currentUser = null;
let currentCalculations = null;

// Initialize user goals
let userGoals = {
    type: null,
    targetCalories: 0,
    targetProtein: 0,
    targetWeight: 0
};

// API helper functions
const apiRequest = async (endpoint, options = {}) => {
    const url = `${API_BASE_URL}${endpoint}`;
    const config = {
        headers: {
            'Content-Type': 'application/json',
            ...options.headers
        },
        ...options
    };

    if (authToken) {
        config.headers.Authorization = `Bearer ${authToken}`;
    }

    try {
        const response = await fetch(url, config);
        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.message || 'API request failed');
        }

        return data;
    } catch (error) {
        console.error('API request error:', error);
        throw error;
    }
};

// Check if user is logged in on page load
document.addEventListener('DOMContentLoaded', function() {
    checkAuthStatus();
    
    // Set default date to today and max date to today
    document.getElementById('date').valueAsDate = new Date();
    setMaxDate();
    
    // Clear login and register forms
    clearAuthForms();
});

// Function to clear authentication forms
function clearAuthForms() {
    // Clear login form
    document.getElementById('loginEmail').value = '';
    document.getElementById('loginPassword').value = '';
    
    // Clear register form
    document.getElementById('registerName').value = '';
    document.getElementById('registerEmail').value = '';
    document.getElementById('registerPassword').value = '';
    document.getElementById('confirmPassword').value = '';
    
    // Clear error messages
    document.querySelectorAll('.error-message').forEach(error => {
        error.style.display = 'none';
    });
}

// Also clear forms when switching between login/register
function showLogin() {
    document.getElementById('registerView').classList.add('hidden');
    document.getElementById('loginView').classList.remove('hidden');
    // Clear forms when showing login
    document.getElementById('loginEmail').value = '';
    document.getElementById('loginPassword').value = '';
}

function showRegister() {
    document.getElementById('loginView').classList.add('hidden');
    document.getElementById('registerView').classList.remove('hidden');
    // Clear forms when showing register
    document.getElementById('registerName').value = '';
    document.getElementById('registerEmail').value = '';
    document.getElementById('registerPassword').value = '';
    document.getElementById('confirmPassword').value = '';
}

function checkAuthStatus() {
    const userData = localStorage.getItem('currentUser');
    const token = localStorage.getItem('authToken');
    
    if (userData && token) {
        currentUser = JSON.parse(userData);
        authToken = token;
        renderAuthenticatedView();
    } else {
        renderGuestView();
    }
}

function renderAuthenticatedView() {
    // Update header with user info
    document.getElementById('authSection').innerHTML = `
        <div class="user-info">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <span>${currentUser.name}</span>
            <button class="auth-btn" onclick="logout()">Logout</button>
        </div>
    `;
    
    // Show dashboard, hide auth views
    document.getElementById('authViews').classList.add('hidden');
    
    // Load user data
    loadUserData();
    
    // Initialize chart
    initializeChart();
    
    // Show personal info page by default
    showPersonalInfoPage();
}

function renderGuestView() {
    // Update header with login/register buttons
    document.getElementById('authSection').innerHTML = `
        <a href="#" class="auth-btn" onclick="showLogin()">Login</a>
        <a href="#" class="auth-btn" onclick="showRegister()">Register</a>
    `;
    
    // Show auth views, hide all other pages
    document.getElementById('personalInfoPage').classList.add('hidden');
    document.getElementById('recommendationsPage').classList.add('hidden');
    document.getElementById('goalSettingPage').classList.add('hidden');
    document.getElementById('dashboardPage').classList.add('hidden');
    document.getElementById('authViews').classList.remove('hidden');
    showLogin();
}

// Page navigation functions
function showPersonalInfoPage() {
    hideAllPages();
    document.getElementById('personalInfoPage').classList.remove('hidden');
}

function showRecommendationsPage() {
    hideAllPages();
    document.getElementById('recommendationsPage').classList.remove('hidden');
}

function showGoalSettingPage() {
    hideAllPages();
    document.getElementById('goalSettingPage').classList.remove('hidden');
    updateCurrentGoalDisplay();
}

function showDashboardPage() {
    hideAllPages();
    document.getElementById('dashboardPage').classList.remove('hidden');
    updateDashboardGoalDisplay();
    loadTrackingHistory();
    updateProgressStats();
    // Update max date whenever dashboard is shown
    setMaxDate();
    
    // Always reinitialize chart when showing dashboard
    setTimeout(() => {
        initializeChart();
    }, 100);
}

function hideAllPages() {
    document.getElementById('personalInfoPage').classList.add('hidden');
    document.getElementById('recommendationsPage').classList.add('hidden');
    document.getElementById('goalSettingPage').classList.add('hidden');
    document.getElementById('dashboardPage').classList.add('hidden');
    document.getElementById('authViews').classList.add('hidden');
}

function showLogin() {
    document.getElementById('registerView').classList.add('hidden');
    document.getElementById('loginView').classList.remove('hidden');
}

function showRegister() {
    document.getElementById('loginView').classList.add('hidden');
    document.getElementById('registerView').classList.remove('hidden');
}

// Login form handler
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Get form values
    const email = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    
    // Reset error messages
    document.getElementById('loginEmailError').style.display = 'none';
    document.getElementById('loginPasswordError').style.display = 'none';
    
    // Validate form
    let isValid = true;
    
    if (!email || !isValidEmail(email)) {
        document.getElementById('loginEmailError').style.display = 'block';
        isValid = false;
    }
    
    if (!password) {
        document.getElementById('loginPasswordError').style.display = 'block';
        isValid = false;
    }
    
    if (!isValid) return;
    
    try {
        const data = await apiRequest('/auth/login', {
            method: 'POST',
            body: JSON.stringify({ email, password })
        });

        currentUser = data.data.user;
        authToken = data.data.token;
        
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        localStorage.setItem('authToken', authToken);
        
        renderAuthenticatedView();
    } catch (error) {
        alert(error.message || 'Login failed. Please try again.');
    }
});

// Register form handler
document.getElementById('registerForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Get form values
    const name = document.getElementById('registerName').value.trim();
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    
    // Reset error messages
    document.getElementById('registerNameError').style.display = 'none';
    document.getElementById('registerEmailError').style.display = 'none';
    document.getElementById('registerPasswordError').style.display = 'none';
    document.getElementById('confirmPasswordError').style.display = 'none';
    
    // Validate form
    let isValid = true;
    
    if (!name) {
        document.getElementById('registerNameError').style.display = 'block';
        isValid = false;
    }
    
    if (!email || !isValidEmail(email)) {
        document.getElementById('registerEmailError').style.display = 'block';
        isValid = false;
    }
    
    if (!password || password.length < 6) {
        document.getElementById('registerPasswordError').style.display = 'block';
        isValid = false;
    }
    
    if (password !== confirmPassword) {
        document.getElementById('confirmPasswordError').style.display = 'block';
        isValid = false;
    }
    
    if (!isValid) return;
    
    try {
        const data = await apiRequest('/auth/register', {
            method: 'POST',
            body: JSON.stringify({ name, email, password })
        });

        currentUser = data.data.user;
        authToken = data.data.token;
        
        localStorage.setItem('currentUser', JSON.stringify(currentUser));
        localStorage.setItem('authToken', authToken);
        
        renderAuthenticatedView();
    } catch (error) {
        alert(error.message || 'Registration failed. Please try again.');
    }
});

function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function setMaxDate() {
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const maxDate = `${yyyy}-${mm}-${dd}`;
    document.getElementById('date').setAttribute('max', maxDate);
}

// Gender selection
function selectGender(gender) {
    document.querySelectorAll('.gender-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    if (gender === 'male') {
        document.querySelector('.male-option').classList.add('selected');
        document.querySelector('.card-icon').innerHTML = '<i class="fas fa-mars"></i>';
        document.querySelector('.card-icon').className = 'card-icon male-icon';
    } else {
        document.querySelector('.female-option').classList.add('selected');
        document.querySelector('.card-icon').innerHTML = '<i class="fas fa-venus"></i>';
        document.querySelector('.card-icon').className = 'card-icon female-icon';
    }
}

// Mifflin-St Jeor BMR calculation
function calculateBMR(weight, height, age, gender) {
    if (gender === 'male') {
        return 10 * weight + 6.25 * height - 5 * age + 5;
    } else {
        return 10 * weight + 6.25 * height - 5 * age - 161;
    }
}

// TDEE calculation
function calculateTDEE(bmr, activityLevel) {
    return bmr * activityLevel;
}

function generateHealthRecommendations(healthCondition) {
    let foodRecommendations = '';
    let activityRecommendations = '';
    
    switch(healthCondition) {
        case 'diabetic':
            foodRecommendations = 'Focus on low glycemic index foods: Whole grains, leafy greens, berries, nuts, legumes. Avoid sugary drinks and processed carbs.';
            activityRecommendations = 'Aerobic exercises: Brisk walking, swimming, cycling (30 mins daily). Strength training 2-3 times weekly. Monitor blood sugar before/after exercise.';
            break;
        case 'heart_patient':
            foodRecommendations = 'Heart-healthy diet: Omega-3 rich foods (salmon, walnuts), oats, olive oil, fruits & vegetables. Limit sodium, saturated fats, and processed foods.';
            activityRecommendations = 'Moderate cardio: Walking, stationary cycling, light swimming (start with 15-20 mins). Avoid heavy weight lifting and high-intensity workouts.';
            break;
        case 'both':
            foodRecommendations = 'Combined approach: High fiber, low sodium, controlled carbs. Emphasize vegetables, lean proteins, healthy fats. Avoid sugar, processed foods, and excess salt.';
            activityRecommendations = 'Gentle consistent activity: Daily walking, light cycling, yoga. Monitor both heart rate and blood sugar. Consult doctor for personalized plan.';
            break;
        default:
            foodRecommendations = 'Balanced diet recommendations: Lean proteins (chicken, fish, tofu), complex carbs (oats, brown rice, quinoa), healthy fats (avocado, nuts, olive oil), plenty of vegetables (spinach, broccoli, carrots), and fruits (berries, apples, bananas). Stay hydrated with water and limit processed foods.';
            activityRecommendations = 'General fitness: 150 minutes of moderate activity weekly. Mix cardio (walking, cycling) with strength training (2-3 times weekly). Include flexibility exercises like stretching or yoga.';
    }
    
    return { food: foodRecommendations, activity: activityRecommendations };
}

// Calculate recommendations based on Mifflin-St Jeor
async function calculateRecommendations() {
    // Get user data
    const gender = document.querySelector('.male-option.selected') ? 'male' : 'female';
    const age = parseInt(document.getElementById('age').value);
    const height = parseInt(document.getElementById('height').value);
    const weight = parseFloat(document.getElementById('weight').value);
    const activityLevel = parseFloat(document.getElementById('activity').value);
    const healthCondition = document.getElementById('healthCondition').value;
    
    // Validate inputs
    if (!age || !height || !weight) {
        alert('Please fill in all fields with valid values.');
        return;
    }
    
    try {
        // Save personal info first
        await apiRequest('/users/personal-info', {
            method: 'PUT',
            body: JSON.stringify({
                gender,
                age,
                height,
                weight,
                activityLevel,
                healthCondition
            })
        });

        // Calculate recommendations
        const data = await apiRequest('/users/calculate-recommendations', {
            method: 'POST',
            body: JSON.stringify({
                gender,
                age,
                height,
                weight,
                activityLevel
            })
        });

        // Store calculations with all necessary data
        currentCalculations = {
            bmr: data.data.bmr,
            tdee: data.data.tdee,
            weight: weight,
            height: height,
            age: age,
            gender: gender,
            activityLevel: activityLevel,
            healthCondition: healthCondition,
            suggestedAction: data.data.suggestedAction,
            targetCalories: data.data.targetCalories,
            targetProtein: data.data.targetProtein,
            targetWeightChange: data.data.targetWeightChange
        };
        
        // Display recommendations
        document.getElementById('bmrValue').textContent = `${data.data.bmr} kcal/day`;
        document.getElementById('tdeeValue').textContent = `${data.data.tdee} kcal/day`;
        document.getElementById('suggestedAction').textContent = data.data.suggestedAction;
        document.getElementById('suggestedCalories').textContent = `${data.data.targetCalories.toLocaleString()} kcal/day`;
        document.getElementById('suggestedProtein').textContent = `${data.data.targetProtein} g/day`;
        document.getElementById('suggestedWeight').textContent = data.data.targetWeightChange;
        
        // Store the suggested goal
        window.suggestedGoal = {
            type: data.data.suggestedAction,
            targetCalories: data.data.targetCalories,
            targetProtein: data.data.targetProtein,
            targetWeight: data.data.suggestedAction === "Weight Loss" ? Math.round((weight * 0.92) * 10) / 10 : 
                          data.data.suggestedAction === "Weight Gain" ? Math.round((weight * 1.08) * 10) / 10 : weight
        };

        // Generate and display health recommendations
        const healthRecs = generateHealthRecommendations(healthCondition);
        document.getElementById('recommendedFoods').textContent = healthRecs.food;
        document.getElementById('recommendedActivities').textContent = healthRecs.activity;
        
        // Show health recommendations section if user has a condition
         document.getElementById('healthRecommendations').style.display = 'block';
        
        showRecommendationsPage();
    } catch (error) {
        alert(error.message || 'Failed to calculate recommendations.');
    }
}

// Show goal preview without setting it
function showGoalPreview(goalType) {
    // Get values directly from form to ensure we have data
    const weight = parseFloat(document.getElementById('weight').value) || 75;
    const activityLevel = parseFloat(document.getElementById('activity').value) || 1.55;
    const age = parseInt(document.getElementById('age').value) || 28;
    const height = parseInt(document.getElementById('height').value) || 175;
    const gender = document.querySelector('.male-option.selected') ? 'male' : 'female';
    
    // Calculate BMR and TDEE directly to ensure we have values
    const bmr = calculateBMR(weight, height, age, gender);
    const tdee = calculateTDEE(bmr, activityLevel);
    
    let targetCalories, targetProtein, targetWeight, goalName, description;
    
    switch(goalType) {
        case 'weight_loss':
            goalName = 'Weight Loss';
            targetCalories = Math.round(tdee * 0.85); // 15% deficit
            targetProtein = Math.round(weight * 2.2); // Higher protein for weight loss
            targetWeight = Math.round((weight * 0.92) * 10) / 10; // 8% weight loss
            description = 'Gradual weight loss focusing on fat reduction while preserving muscle mass.';
            break;
        case 'muscle_gain':
            goalName = 'Muscle Gain';
            targetCalories = Math.round(tdee * 1.15); // 15% surplus
            targetProtein = Math.round(weight * 2.0); // Moderate protein for muscle gain
            targetWeight = Math.round((weight * 1.08) * 10) / 10; // 8% weight gain
            description = 'Focused on building lean muscle mass through proper nutrition and strength training.';
            break;
        case 'maintenance':
            goalName = 'Maintenance';
            targetCalories = Math.round(tdee); // Maintenance calories
            targetProtein = Math.round(weight * 1.6); // Standard protein
            targetWeight = weight; // Maintain current weight
            description = 'Maintain current weight and body composition while improving overall fitness.';
            break;
        case 'endurance':
            goalName = 'Endurance Training';
            targetCalories = Math.round(tdee * 1.05); // Slight surplus for energy
            targetProtein = Math.round(weight * 1.8); // Moderate protein
            targetWeight = Math.round((weight * 0.96) * 10) / 10; // Slight weight loss
            description = 'Optimized for endurance activities with adequate energy and protein for recovery.';
            break;
        default:
            goalName = 'Custom';
            targetCalories = Math.round(tdee);
            targetProtein = Math.round(weight * 1.6);
            targetWeight = weight;
            description = 'Custom fitness goal.';
    }
    
    // Show preview
    document.getElementById('previewType').textContent = goalName;
    document.getElementById('previewCalories').textContent = targetCalories.toLocaleString() + ' kcal/day';
    document.getElementById('previewProtein').textContent = targetProtein + ' g/day';
    document.getElementById('previewWeight').textContent = targetWeight + ' kg';
    
    // Add description
    const previewDescription = document.getElementById('previewDescription');
    if (previewDescription) {
        previewDescription.textContent = description;
    }
    
    document.getElementById('goalPreview').classList.remove('hidden');
    
    // Store the suggested goal temporarily
    window.tempGoal = {
        type: goalName,
        targetCalories: targetCalories,
        targetProtein: targetProtein,
        targetWeight: targetWeight
    };
}

// Set goal from preview
async function setGoalFromPreview() {
    if (!window.tempGoal) return;
    
    try {
        await apiRequest('/users/goals', {
            method: 'PUT',
            body: JSON.stringify(window.tempGoal)
        });
        
        userGoals = window.tempGoal;
        updateCurrentGoalDisplay();
        updateDashboardGoalDisplay();
        
        // Hide preview
        document.getElementById('goalPreview').classList.add('hidden');
        
        alert(`Goal set to: ${userGoals.type}`);
        
    } catch (error) {
        alert(error.message || 'Failed to set goal.');
    }
}

// Set custom goal
async function setCustomGoal() {
    const customGoal = document.getElementById('customGoal').value.trim();
    
    if (!customGoal) {
        alert('Please enter a custom goal.');
        return;
    }
    
    // Get values from form
    const weight = parseFloat(document.getElementById('weight').value) || 75;
    const activityLevel = parseFloat(document.getElementById('activity').value) || 1.55;
    const age = parseInt(document.getElementById('age').value) || 28;
    const height = parseInt(document.getElementById('height').value) || 175;
    const gender = document.querySelector('.male-option.selected') ? 'male' : 'female';
    
    // Calculate TDEE
    const bmr = calculateBMR(weight, height, age, gender);
    const tdee = calculateTDEE(bmr, activityLevel);
    
    const goalData = {
        type: customGoal,
        targetCalories: Math.round(tdee),
        targetProtein: Math.round(weight * 1.6),
        targetWeight: weight
    };
    
    try {
        await apiRequest('/users/goals', {
            method: 'PUT',
            body: JSON.stringify(goalData)
        });
        
        userGoals = goalData;
        updateCurrentGoalDisplay();
        updateDashboardGoalDisplay();
        
        document.getElementById('customGoal').value = '';
        
        alert(`Custom goal set to: ${customGoal}`);
        
    } catch (error) {
        alert(error.message || 'Failed to set custom goal.');
    }
}

// Update current goal display
function updateCurrentGoalDisplay() {
    document.getElementById('currentGoal').textContent = userGoals.type || 'Not set';
    document.getElementById('targetCalories').textContent = userGoals.targetCalories ? 
        userGoals.targetCalories.toLocaleString() + ' kcal/day' : '-';
    document.getElementById('targetProtein').textContent = userGoals.targetProtein ? 
        userGoals.targetProtein + ' g/day' : '-';
    document.getElementById('targetWeight').textContent = userGoals.targetWeight ? 
        userGoals.targetWeight + ' kg' : '-';
}

// Update dashboard goal display
function updateDashboardGoalDisplay() {
    document.getElementById('dashboardGoal').textContent = userGoals.type || 'Not set';
    document.getElementById('dashboardCalories').textContent = userGoals.targetCalories ? 
        userGoals.targetCalories.toLocaleString() + ' kcal/day' : '-';
    document.getElementById('dashboardProtein').textContent = userGoals.targetProtein ? 
        userGoals.targetProtein + ' g/day' : '-';
    document.getElementById('dashboardWeight').textContent = userGoals.targetWeight ? 
        userGoals.targetWeight + ' kg' : '-';
}

// Update chart data dynamically
function updateChartData(entries) {
    if (!window.progressChartInstance) return;
    
    if (entries.length === 0) {
        initializeChart();
        return;
    }
    
    // Extract data for chart
    const dates = entries.map(entry => {
        const date = new Date(entry.date);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    });
    const weights = entries.map(entry => entry.weight);
    const calories = entries.map(entry => entry.calories);
    
    // Update chart data
    window.progressChartInstance.data.labels = dates;
    window.progressChartInstance.data.datasets[0].data = weights;
    window.progressChartInstance.data.datasets[1].data = calories;
    
    // Update scales if needed
    const weightMin = Math.min(...weights) - 2;
    const weightMax = Math.max(...weights) + 2;
    const caloriesMin = Math.min(0, Math.min(...calories) - 200);
    const caloriesMax = Math.max(...calories) + 200;
    
    window.progressChartInstance.options.scales.y.min = weightMin;
    window.progressChartInstance.options.scales.y.max = weightMax;
    window.progressChartInstance.options.scales.y1.min = caloriesMin;
    window.progressChartInstance.options.scales.y1.max = caloriesMax;
    
    // Refresh chart
    window.progressChartInstance.update('active');
}

// Add daily tracking entry
async function addEntry() {
    const date = document.getElementById('date').value;
    const calories = parseInt(document.getElementById('calories').value);
    const protein = parseInt(document.getElementById('protein').value);
    const currentWeight = parseFloat(document.getElementById('currentWeight').value);
    
    if (!date || !calories || !protein || !currentWeight) {
        alert('Please fill in all fields.');
        return;
    }

    // Validate date is not in the future
    const selectedDate = new Date(date);
    const today = new Date();
    
    // Set both dates to start of day for accurate comparison
    selectedDate.setHours(0, 0, 0, 0);
    today.setHours(0, 0, 0, 0);
    
    if (selectedDate > today) {
        alert('Cannot add entries for future dates. Please select today or a past date.');
        return;
    }

    if (calories > 2000) {
        alert('Calories cannot exceed 2000. Please enter a value between 0-2000.');
        return;
    }
    
    if (protein > 160) {
        alert('Protein intake cannot exceed 160g. Please enter a value between 0-160g.');
        return;
    }
    
    try {
        await apiRequest('/tracking/entries', {
            method: 'POST',
            body: JSON.stringify({
                date,
                calories,
                protein,
                weight: currentWeight
            })
        });

        alert('Daily entry saved successfully!');
        
        // Reset form for next entry
        document.getElementById('date').valueAsDate = new Date();
        
        // Refresh dashboard data
        loadTrackingHistory();
        updateProgressStats();
        initializeChart();
    } catch (error) {
        alert(error.message || 'Failed to save entry.');
    }
}

// Load tracking history
async function loadTrackingHistory() {
    try {
        const data = await apiRequest('/tracking/entries');
        const entries = data.data.entries;
        
        const historyTable = document.getElementById('historyTable');
        
        // Clear table
        historyTable.innerHTML = '';
        
        // Add entries to table
        entries.forEach(entry => {
            const row = document.createElement('tr');
            
            // Calculate goal progress
            let progress = 'ðŸ”´'; // Default to red
            
            if (userGoals.targetCalories && userGoals.targetProtein) {
                const caloriesProgress = entry.calories / userGoals.targetCalories;
                const proteinProgress = entry.protein / userGoals.targetProtein;
                
                const avgProgress = (caloriesProgress + proteinProgress) / 2;
                
                if (avgProgress >= 0.95) {
                    progress = 'ðŸŸ¢';
                } else if (avgProgress >= 0.85) {
                    progress = 'ðŸŸ¡';
                } else if (avgProgress >= 0.70) {
                    progress = 'ðŸŸ ';
                }
            }
            
            const entryDate = new Date(entry.date).toISOString().split('T')[0];
            
            row.innerHTML = `
                <td>${entryDate}</td>
                <td>${entry.calories} kcal</td>
                <td>${entry.protein} g</td>
                <td>${entry.weight} kg</td>
                <td>${progress}</td>
            `;
            
            historyTable.appendChild(row);
        });
        
        // Update chart if we're on dashboard
        if (!document.getElementById('dashboardPage').classList.contains('hidden')) {
            updateChartData(entries);
        }
    } catch (error) {
        console.error('Failed to load tracking history:', error);
    }
}

// Update progress stats
async function updateProgressStats() {
    try {
        const data = await apiRequest('/tracking/progress-stats');
        const latestEntry = data.data.latestEntry;
        
        if (!latestEntry) {
            // Set default values if no entries
            document.querySelector('.stat-value.calories').textContent = '0';
            document.querySelector('.stat-value.protein').textContent = '0g';
            document.querySelector('.stat-value.weight').textContent = '0kg';
            return;
        }
        
        // Update stats
        document.querySelector('.stat-value.calories').textContent = latestEntry.calories;
        document.querySelector('.stat-value.protein').textContent = `${latestEntry.protein}g`;
        document.querySelector('.stat-value.weight').textContent = `${latestEntry.weight}kg`;
        
        // Update progress bars and text
        if (userGoals.targetCalories) {
            const caloriesProgress = Math.min(latestEntry.calories / userGoals.targetCalories * 100, 100);
            document.getElementById('caloriesProgress').style.width = `${caloriesProgress}%`;
            document.getElementById('caloriesText').textContent = 
                `${latestEntry.calories} of ${userGoals.targetCalories} kcal`;
        }
        
        if (userGoals.targetProtein) {
            const proteinProgress = Math.min(latestEntry.protein / userGoals.targetProtein * 100, 100);
            document.getElementById('proteinProgress').style.width = `${proteinProgress}%`;
            document.getElementById('proteinText').textContent = 
                `${latestEntry.protein} of ${userGoals.targetProtein}g`;
        }
        
        if (userGoals.targetWeight) {
            document.getElementById('weightText').textContent = 
                `Goal: ${userGoals.targetWeight}kg`;
        }
    } catch (error) {
        console.error('Failed to update progress stats:', error);
    }
}

// Initialize chart
function initializeChart() {
    const ctx = document.getElementById('progressChart').getContext('2d');
    
    // Get user data from localStorage for initial load
    // This will be updated when we load tracking history from backend
    const entries = [];
    
    // Destroy existing chart if it exists
    if (window.progressChartInstance) {
        window.progressChartInstance.destroy();
    }
    
    // If no entries, show empty chart with message
    if (entries.length === 0) {
        window.progressChartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['No data yet'],
                datasets: [
                    {
                        label: 'Weight (kg)',
                        data: [0],
                        borderColor: '#4361ee',
                        backgroundColor: 'rgba(67, 97, 238, 0.1)',
                        borderWidth: 2,
                        yAxisID: 'y',
                        tension: 0.3,
                        fill: true
                    },
                    {
                        label: 'Calories',
                        data: [0],
                        borderColor: '#ffcc00',
                        backgroundColor: 'rgba(255, 204, 0, 0.1)',
                        borderWidth: 2,
                        yAxisID: 'y1',
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: {
                            display: true,
                            text: 'Weight (kg)'
                        },
                        min: 0,
                        max: 100
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: {
                            display: true,
                            text: 'Calories'
                        },
                        grid: {
                            drawOnChartArea: false
                        },
                        min: 0,
                        max: 3000
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Add tracking entries to see your progress!',
                        color: '#6c757d',
                        font: {
                            size: 14
                        }
                    }
                }
            }
        });
        return;
    }
    
    // Extract data for chart
    const dates = entries.map(entry => {
        const date = new Date(entry.date);
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    });
    const weights = entries.map(entry => entry.weight);
    const calories = entries.map(entry => entry.calories);
    
    // Calculate dynamic ranges for better visualization
    const weightMin = Math.min(...weights) - 2;
    const weightMax = Math.max(...weights) + 2;
    const caloriesMin = Math.min(0, Math.min(...calories) - 200);
    const caloriesMax = Math.max(...calories) + 200;
    
    // Create chart
    window.progressChartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                {
                    label: 'Weight (kg)',
                    data: weights,
                    borderColor: '#4361ee',
                    backgroundColor: 'rgba(67, 97, 238, 0.1)',
                    borderWidth: 3,
                    yAxisID: 'y',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#4361ee',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverRadius: 7
                },
                {
                    label: 'Calories',
                    data: calories,
                    borderColor: '#ffcc00',
                    backgroundColor: 'rgba(255, 204, 0, 0.1)',
                    borderWidth: 3,
                    yAxisID: 'y1',
                    tension: 0.4,
                    fill: true,
                    pointBackgroundColor: '#ffcc00',
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            plugins: {
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleColor: '#ffffff',
                    bodyColor: '#ffffff',
                    borderColor: '#4361ee',
                    borderWidth: 1,
                    cornerRadius: 8,
                    displayColors: true
                },
                legend: {
                    labels: {
                        usePointStyle: true,
                        padding: 20,
                        font: {
                            size: 12
                        }
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Date',
                        color: '#6c757d',
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    title: {
                        display: true,
                        text: 'Weight (kg)',
                        color: '#4361ee',
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    },
                    min: weightMin,
                    max: weightMax,
                    grid: {
                        color: 'rgba(67, 97, 238, 0.1)'
                    },
                    ticks: {
                        color: '#4361ee'
                    }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'Calories',
                        color: '#ffcc00',
                        font: {
                            size: 12,
                            weight: 'bold'
                        }
                    },
                    min: caloriesMin,
                    max: caloriesMax,
                    grid: {
                        drawOnChartArea: false
                    },
                    ticks: {
                        color: '#ffcc00'
                    }
                }
            },
            animation: {
                duration: 1000,
                easing: 'easeOutQuart'
            }
        }
    });
}

// Load user data
async function loadUserData() {
    try {
        const data = await apiRequest('/users/me');
        const user = data.data.user;
        
        if (user.goals) {
            userGoals = user.goals;
        }
        
        if (user.personalInfo) {
            // Pre-fill personal info form
            if (user.personalInfo.gender) {
                selectGender(user.personalInfo.gender);
            }
            if (user.personalInfo.age) {
                document.getElementById('age').value = user.personalInfo.age;
            }
            if (user.personalInfo.height) {
                document.getElementById('height').value = user.personalInfo.height;
            }
            if (user.personalInfo.weight) {
                document.getElementById('weight').value = user.personalInfo.weight;
            }
            if (user.personalInfo.activityLevel) {
                document.getElementById('activity').value = user.personalInfo.activityLevel;
            }
            if (user.personalInfo.healthCondition) {
                document.getElementById('healthCondition').value = user.personalInfo.healthCondition;
            }
        }
    } catch (error) {
        console.error('Failed to load user data:', error);
    }
}

// Update logout function
function logout() {
    localStorage.removeItem('currentUser');
    localStorage.removeItem('authToken');
    currentUser = null;
    authToken = null;
    checkAuthStatus();
}

// Quick goal setting function
function setQuickGoal(goalType) {
    showGoalPreview(goalType);
}
    </script>
</body>
</html>